# Requirements Estimation System - Project Wiki

## Overview
Sistema web multi-tecnologia per la stima strutturata e ripetibile dell'effort di sviluppo. Integra AI per suggerimenti di attività e un motore di calcolo deterministico per le stime. Supporta Power Platform, Java, .NET, React, SAP e altri stack tecnologici.

---

## 1. FRONTEND (src/)
Applicazione React + TypeScript con Vite, Shadcn-UI e Tailwind CSS.

### src/components/
Componenti UI organizzati per funzionalità:

- **auth/** - Autenticazione e protezione route
  - `AuthGuard.tsx` - HOC per route protette

- **requirements/** - Gestione requisiti
  - `CreateRequirementDialog.tsx` - Dialog creazione requisito
  - `RequirementWizard.tsx` - Wizard guidato per requisiti
  - `BulkEstimateDialog.tsx` - Stima batch multipli requisiti
  - `BulkInterviewDialog.tsx` - Intervista AI batch
  - `ImportRequirementsDialog.tsx` - Import massivo da CSV/Excel
  - **detail/** - Visualizzazione dettaglio requisito
    - **tabs/** - Tab Overview, Estimation, History
  - **wizard/** - Step del wizard (1-5 + Interview)

- **estimation/** - Motore di stima e UI
  - `QuickEstimate.tsx` - Stima rapida dalla home
  - `ActivitiesSection.tsx` - Selezione attività
  - `DriversSection.tsx` - Configurazione driver (complexity, env, etc.)
  - `RisksSection.tsx` - Gestione rischi e contingency
  - `CalculationSummary.tsx` - Riepilogo calcolo deterministico
  - `EstimationComparison.tsx` - Confronto tra stime
  - `EstimationTimeline.tsx` - Timeline storico stime
  - **interview/** - Workflow intervista AI per raccolta requisiti
  - **quick-estimate/** - Componenti per stima veloce (no login)

- **configuration/presets/** - Gestione Technology Presets
  - `TechnologyDialog.tsx` - CRUD preset tecnologici
  - `PresetTableRow.tsx` - Visualizzazione riga preset
  - `PresetPreviewDialog.tsx` - Anteprima preset
  - **ai-wizard/** - Wizard AI per generazione preset custom
    - `AiTechnologyWizard.tsx` - Orchestrator wizard AI
    - `DescriptionInput.tsx` - Input descrizione tecnologia
    - `DynamicQuestionnaire.tsx` - Questionario dinamico
    - `InterviewStep.tsx` - Step intervista AI
    - `ReviewStep.tsx` - Revisione e conferma preset generato

- **lists/** - Gestione liste/progetti
  - `CreateListDialog.tsx` - Creazione nuova lista
  - `EditListDialog.tsx` - Modifica lista
  - `DeleteListDialog.tsx` - Eliminazione lista
  - `ClearListDialog.tsx` - Svuotamento lista

- **dashboard/** - Visualizzazioni e KPI
  - `KpiCard.tsx` - Card metriche aggregate
  - `ProjectCard.tsx` - Card progetto con summary
  - `RecentRequirements.tsx` - Ultimi requisiti modificati

- **charts/** - Grafici e visualizzazioni
  - `StatusDistributionChart.tsx` - Distribuzione per stato
  - `TechStackUsageChart.tsx` - Uso stack tecnologici

- **export/** - Export dati
  - `ExportDialog.tsx` - Dialog export PDF/CSV/Excel

- **organizations/** - Multi-tenancy
  - `CreateOrganizationDialog.tsx` - Creazione org
  - `MembersList.tsx` - Gestione membri

- **layout/** - Layout e navigazione
  - `Header.tsx` - Header con navigazione
  - `SynteroMark.tsx` - Branding

- **shared/** - Componenti condivisi
  - `OrganizationSwitcher.tsx` - Switch tra organizzazioni
  - `ProjectStatusControl.tsx` - Controllo stato progetto
  - `RequirementBadges.tsx` - Badge priority/stato/labels
  - `LockBanner.tsx` - Banner per stato locked

- **ui/** - Componenti Shadcn-UI base
  - 50+ componenti UI riutilizzabili (button, dialog, form, table, etc.)

- **ringParticles/** - Effetti visivi particelle (background animato)

### src/pages/
Route e pagine principali:

- **auth/** - Login, Register
- **dashboard/** - Dashboard principale con KPI e treemap
- **requirements/** - Requirements (lista), RequirementDetail (dettaglio)
- **configuration/** - Configuration (tabs: Activities, Presets, Organization, Profile)
- **test/** - AiWizardTestPage per testing AI wizard
- `Home.tsx` - Landing page con quick estimate (no login)
- `HowItWorks.tsx` - Guida all'uso
- `Index.tsx` - Root route
- `NotFound.tsx` - 404

### src/hooks/
Custom hooks per logica business:

- `useAuth.ts` - Gestione autenticazione Supabase
- `useRequirementsList.ts` - Fetch e gestione lista requisiti
- `useRequirement.ts` - Fetch singolo requisito
- `useRequirementActions.ts` - CRUD requisiti
- `useEstimationData.ts` - Caricamento dati per stima (activities, drivers, risks)
- `useEstimationState.ts` - State management stima in corso
- `useEstimationActions.ts` - Salvataggio stime
- `useEstimationHistory.ts` - Storico stime per requisito
- `useQuickEstimation.ts` - Logica quick estimate (no login)
- `useRequirementInterview.ts` - Workflow intervista AI
- `useBulkInterview.ts` - Intervista batch multipli requisiti
- `useRequirementNormalization.ts` - Normalizzazione testo requisiti
- `useActivityManagement.ts` - Gestione attività
- `useActivityActions.ts` - CRUD attività
- `usePresetManagement.ts` - Gestione preset
- `useTechnologyValidation.ts` - Validazione preset tecnologici
- `useAiWizardState.ts` - State management wizard AI
- `useWizardState.ts` - State management wizard requisiti
- `useDashboardData.ts` - Dati aggregati dashboard
- **workflow/** - `useWorkflow.ts` - Engine workflow stati requisiti

### src/lib/
Librerie e utilities:

- `supabase.ts` - Client Supabase (DB + Auth)
- `openai.ts` - Client OpenAI (deprecato - ora netlify functions)
- `estimationEngine.ts` - Motore di calcolo deterministico
- `api.ts` - API REST per CRUD entities
- `ai-interview-api.ts` - API intervista AI singola
- `bulk-interview-api.ts` - API intervista AI batch
- `requirement-interview-api.ts` - API intervista requisito
- `ai-preset-api.ts` - API generazione preset AI
- `validation.ts` - Validazione input utente
- `constants.ts` - Costanti applicazione
- `utils.ts` - Utility generiche
- `toastHelpers.ts` - Helper per notifiche toast
- `netlify.ts` - Helper per Netlify functions
- **export/** - `csvGenerator.ts`, `excelGenerator.ts`, `pdfGenerator.ts`
- **workflow/** - `Engine.ts`, `types.ts`, **definitions/** (personal, team)

### src/types/
Type definitions TypeScript:

- `database.ts` - Tipi generati da Supabase schema
- `estimation.ts` - Tipi per stima (Activity, Driver, Risk, Preset)
- `requirement-interview.ts` - Tipi intervista AI
- `bulk-interview.ts` - Tipi intervista batch
- `ai-preset-generation.ts` - Tipi generazione preset AI
- `ai-validation.ts` - Tipi validazione AI
- `export.ts` - Tipi export dati

### src/store/
State management globale:

- `useAuthStore.ts` - Zustand store per autenticazione

### src/test/
Test suite:

- `setup.ts` - Setup Vitest
- `estimationConsistency.test.ts` - Test calcolo deterministico
- `estimationHistory.test.tsx` - Test storico stime
- `activity-validation.test.ts` - Test validazione attività
- `apiValidation.test.ts` - Test validazione API
- `preset-pipeline.test.ts` - Test pipeline preset AI
- `aiVariance.test.ts` - Test variance risposte AI
- `aiStructuredOutputs.test.ts` - Test structured outputs OpenAI

---

## 2. BACKEND (netlify/functions/)
Serverless functions per integrazioni AI e business logic server-side.

### netlify/functions/
Endpoints Netlify Functions:

- `ai-suggest.ts` - Suggerimento attività AI per requisito
- `ai-generate-questions.ts` - Generazione domande intervista AI
- `ai-requirement-interview.ts` - Conduzione intervista AI
- `ai-estimate-from-interview.ts` - Stima da risposte intervista
- `ai-bulk-interview.ts` - Intervista batch multipli requisiti
- `ai-bulk-estimate-with-answers.ts` - Stima batch con risposte
- `ai-generate-preset.ts` - Generazione preset tecnologico custom

### netlify/functions/lib/
Librerie condivise backend:

- **ai/** - Logica AI
  - `openai-client.ts` - Client OpenAI con retry/error handling
  - `prompt-builder.ts` - Builder prompt strutturati
  - `ai-cache.ts` - Cache risposte AI (Redis/memory)
  - **actions/** - Azioni AI atomiche
    - `suggest-activities.ts` - Suggerimento attività
    - `generate-questions.ts` - Generazione domande
    - `generate-title.ts` - Generazione titolo
    - `normalize-requirement.ts` - Normalizzazione requisito
    - `generate-preset.ts` - Generazione preset
  - **pipeline/** - Pipeline orchestrazione AI
    - `preset-pipeline.ts` - Pipeline multi-step generazione preset
  - **prompts/** - System prompts
    - `expand.system` - Prompt espansione requisiti
    - `policy.system` - Policy guidelines AI
    - `skeleton.system` - Template base
    - `preset-generation.ts` - Prompt generazione preset
    - `question-generation.ts` - Prompt generazione domande
  - **validation/** - Validazione output AI
    - `preset-schema.ts` - Schema validazione preset

- **auth/** - Autenticazione
  - `auth-validator.ts` - Validazione JWT Supabase

- **security/** - Sicurezza
  - `cors.ts` - Gestione CORS
  - `rate-limiter.ts` - Rate limiting API

- **validation/** - Validazione business
  - `requirement-validator.ts` - Validazione requisiti
  - `activity-genericness-validator.ts` - Validazione genericità attività

---

## 3. DATABASE (supabase/)

### Schema Principale (supabase_schema.sql)
Tabelle core con Row Level Security (RLS):

- `organizations` - Multi-tenancy, organizzazioni
- `organization_members` - Membri organizzazioni
- `lists` - Liste/progetti di requisiti
- `requirements` - Requisiti funzionali
- `estimations` - Stime salvate
- `estimation_activities` - Attività selezionate per stima
- `estimation_drivers` - Driver applicati a stima
- `estimation_risks` - Rischi selezionati per stima
- `activities` - Catalogo attività (ANL_ALIGN, API_ENDPOINT, etc.)
- `drivers` - Catalogo driver (Complexity, Environments, etc.)
- `risks` - Catalogo rischi (R_INTEG_EXT, R_PERF, etc.)
- `technology_presets` - Preset tecnologici (TECH_PP_BASIC, TECH_JAVA_API, etc.)

### Seed Data (supabase_seed.sql)
Dati iniziali:
- 50+ attività per tecnologie multiple (Power Platform, Java, React, .NET, etc.)
- 5+ driver standard (Complexity, Environments, Reuse, Stakeholders, Regulation)
- 10+ rischi comuni (integrazione, performance, migration, legacy, etc.)
- 10+ technology preset predefiniti

### Migrations (supabase/migrations/)
Migrazioni schema:
- `20260130_consolidated_multitenancy.sql` - Setup multi-tenancy
- `20260130_add_ai_reasoning_to_estimations.sql` - Campo AI reasoning
- `20251205_standardize_states.sql` - Standardizzazione stati
- `20251205_consolidate_technologies.sql` - Consolidamento preset
- `20251204_multitenancy_schema.sql` - Schema multi-tenancy
- Altre migrazioni storiche

### migrations/
SQL scripts standalone:
- `migrate_base_days_to_base_hours.sql` - Migrazione giorni → ore

### Root SQL Files
Script utility:
- `supabase_granular_activities.sql` - Attività granulari
- `supabase_presets_customization.sql` - Customizzazione preset
- `supabase_save_estimation_rpc.sql` - RPC salvataggio atomico stima
- `supabase_technologies.sql` - Technology preset addizionali
- `estimation_history_optimizations.sql` - Ottimizzazioni performance storico

---

## 4. DOCUMENTAZIONE (docs/)

### docs/ai/
Documentazione AI:
- `ai-system-overview.md` - Overview sistema AI
- `ai-technology-wizard-implementation-plan.md` - Piano wizard AI preset
- `ai-input-validation.md` - Validazione input AI
- `ai-variance-testing.md` - Testing variance AI
- `refactoring-architecture.md` - Architettura refactoring AI
- `PIPELINE_IMPLEMENTATION_GUIDE.md` - Guida pipeline AI
- `PIPELINE_DEPENDENCIES.md` - Dipendenze pipeline
- `KEY_POLICY.md` - Policy gestione chiavi API
- `PARADIGM_SHIFT_CATALOG_TO_CUSTOM.md` - Shift da catalogo a custom
- `PRESET_ACTIVITIES_ANALYSIS.md` - Analisi attività preset
- `IMPLEMENTATION_COMPLETE.md` - Riepilogo implementazione
- Altre guide implementative

### docs/architecture/
Architettura sistema:
- `functional-analysis.md` - Analisi funzionale
- `estimation-flows-comparison.md` - Confronto flussi stima
- `estimation-consistency-fix.md` - Fix consistenza calcoli
- `estimation-history-implementation.md` - Implementazione storico
- `granular-activities-guide.md` - Guida attività granulari
- `multitenancy-governance.md` - Governance multi-tenancy
- `tech-preset-integrity.md` - Integrità preset
- `security-fix-a2-a7.md` - Fix sicurezza OWASP
- `base_hours_migration.md` - Migrazione ore base

### docs/testing/
Guide testing:
- `testing-guide.md` - Guida generale testing
- `test-plan-ai-phase1.md` - Piano test AI Phase 1
- `manual-api-test-guide.md` - Test manuali API
- `test-manual-guide.md` - Guida test manuali
- `automated-test-results.md` - Risultati test automatizzati
- `testing-automation-summary.md` - Summary automazione

### docs/deployment/
Deployment:
- `deployment.md` - Guida deployment (Netlify, Vercel, AWS, etc.)

### docs/setup/
Setup:
- `setup-guide.md` - Guida setup progetto

### docs/components/
Documentazione componenti UI:
- `QUICK_REFERENCE.md` - Quick reference componenti
- `input-focus-refactoring.md` - Refactoring focus input
- `input-focus-visual-guide.md` - Guida visiva focus
- `mouse-interaction-guide.md` - Interazioni mouse
- `ring-particles-background.md` - Documentazione effetti particelle

### docs/operations/
Operazioni:
- `consistency-fix-log.md` - Log fix consistenza
- `critical-fixes-summary.md` - Summary fix critici

### docs/diagrams/
Diagrammi:
- `ERD.mmd` - Entity Relationship Diagram (Mermaid)
- `sequences.mmd` - Sequence diagrams (Mermaid)
- `index.html` - Viewer diagrammi

### docs/templates/
Template:
- `page-layout-template.md` - Template layout pagine

### docs/archive/
Documentazione storica archiviata

### Root Docs Files
- `README.md` - Overview progetto e features
- `CHANGELOG.md` - Changelog releases
- `architecture.md` - Architettura generale
- `data-model.md` - Modello dati
- `estimation-engine.md` - Documentazione engine calcolo
- `technology-presets.md` - Guida preset tecnologici
- `ai-integration.md` - Integrazione AI
- `todo.md` - TODO list features future

---

## 5. CONFIGURAZIONE

### Root Config Files
- `.env.example` - Template variabili ambiente
- `vite.config.ts` - Configurazione Vite
- `tsconfig.json`, `tsconfig.app.json`, `tsconfig.node.json` - TypeScript config
- `tailwind.config.ts` - Configurazione Tailwind CSS
- `postcss.config.js` - PostCSS config
- `eslint.config.js` - ESLint config
- `components.json` - Shadcn-UI components registry
- `netlify.toml` - Configurazione Netlify deploy
- `template_config.json` - Configurazione template
- `deno.lock` - Lock file Deno

### Package Management
- `package.json` - Dependencies e scripts npm
- `package-lock.json` - Lock file npm

---

## 6. BUILD & DEPLOY

### public/
Asset statici:
- `favicon.svg` - Favicon
- `logo.svg`, `logo.png`, `logo1.svg` - Loghi
- `ring-particles.worklet.js` - Worklet particelle (Audio API)
- `robots.txt` - SEO

### scripts/
Utility scripts:
- `test-ai-variance.ts` - Test variance AI
- `test-validation.ts` - Test validazione
- `docs-check.mjs` - Check consistenza docs
- `docs-update.mjs` - Update docs automatico
- `quick-test.js` - Quick test runner
- Altri script di debugging/parsing

### .github/workflows/
CI/CD:
- `secret-scan.yml` - Scan segreti in commit

### .netlify/
Build artifacts Netlify (generati, non committati):
- `functions-serve/` - Functions locali
- `v1/` - Build cache

---

## 7. IMPLEMENTAZIONI SPECIALI

### Mouse Interaction
- `MOUSE_INTERACTION_IMPLEMENTATION.md` - Implementazione tracking mouse
- `src/lib/mouseTracking.ts` - Logic tracking
- `src/components/ParticleInteractionControl.tsx` - Controllo interazioni

### Ring Particles Background
- `RING_PARTICLES_IMPLEMENTATION.md` - Implementazione effetti particelle
- `src/components/RingParticlesBackground.tsx` - Componente background
- `src/components/RingParticlesCanvas.tsx` - Canvas rendering
- `src/lib/ringParticlesConfig.ts` - Configurazione
- `src/lib/noise.ts` - Generatore noise per animazioni

---

## Technology Stack

**Frontend:**
- React 18 + TypeScript
- Vite (build tool)
- Shadcn-UI + Radix UI
- Tailwind CSS
- React Router
- Zustand (state management)
- Recharts (grafici)

**Backend:**
- Netlify Functions (serverless)
- Supabase (PostgreSQL + Auth + RLS)
- OpenAI API (GPT-4 per AI suggestions)

**Testing:**
- Vitest
- React Testing Library

**Deployment:**
- Netlify (primary)
- Vercel, AWS Amplify (alternative)

---

## Quick Start

```bash
# Install dependencies
cd shadcn-ui
npm install

# Setup Supabase database
# 1. Create Supabase project
# 2. Run supabase_schema.sql in SQL editor
# 3. Run supabase_seed.sql in SQL editor

# Configure environment
cp .env.example .env
# Edit .env with Supabase and OpenAI credentials

# Start development server
npm run dev
```

---

## Key Features

1. **Quick Estimate (Home)** - Stima senza login in 5 step
2. **AI Activity Suggestions** - Selezione automatica attività rilevanti
3. **Deterministic Calculation** - Engine calcolo trasparente e ripetibile
4. **Multi-Technology** - Power Platform, Java, .NET, React, SAP, etc.
5. **Technology Presets** - Preset configurabili per stack tecnologici
6. **Lists Management** - Organizzazione requisiti in liste/progetti
7. **Estimation History** - Storico completo stime con confronto
8. **Dashboard & Analytics** - KPI, treemap, grafici distribuzione
9. **Bulk Operations** - Stima e intervista batch multipli requisiti
10. **Export** - Export Excel, CSV, PDF (planned)
11. **Multi-tenancy** - Organizzazioni con RLS
12. **AI Wizard Preset** - Generazione preset custom via intervista AI

---

## Security

- Row Level Security (RLS) su tutte le tabelle
- JWT authentication via Supabase
- OpenAI API key server-side only (Netlify Functions)
- CORS protection
- Rate limiting su API
- Input validation client + server
- Audit trail su tutte le modifiche

---

## Notes

- Il sistema usa AI SOLO per suggerire attività, NON per calcolare giorni
- Il calcolo è sempre deterministico e basato su formula trasparente
- I Technology Preset sono il cuore del sistema (attività + driver + rischi per stack)
- Row Level Security garantisce data isolation tra organizzazioni
- Il wizard AI preset permette di generare preset custom senza configurazione manuale
